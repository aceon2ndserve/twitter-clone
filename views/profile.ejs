<!DOCTYPE html>
<html>
<head>
  <title>User Profile</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="/css/index.css">

  <a class="btn btn-danger btn-sm" href="/users/logout">Logout</a>
  <a class="btn btn-primary btn-sm" href="/users/<%= currentUserId %>">Go to your profile</a>

</head>
<body>
  <div class="container mt-5">
    <div class="row">
      <div class="col-md-6">
        <h1>Logged in as <%= username %></h1>
        <h2> <%= user.username %>'s Profile (Followers: <%= user.followers.length %> Following: <%= user.following.length %> ):</h2>
        
        <ul class="list-group">
          <% if (tweets.length === 0) { %>
            <h4>There are no tweets yet</h4>
          
            <% } %>
            <h3> Tweets </h3>
          <% tweets.forEach((tweet) => { %>
            
            <li class="list-group-item">
              <div class="tweet-text">
                <%= tweet.text %>
            
              </div>
               <!-- Display comments for the tweet -->
               <h4>Comments:</h4>
               <ul class="list-group">
                <% tweet.comments.forEach((comment) => { %>
                  <li class="list-group-item">
                    <!-- Display comment content -->
                    <%= comment.text %>
                  </li>
                <% }); %>
              </ul>
              <div class="float-end"><%= tweet.likedBy.length %> Likes </div>
    <!-- Button to add a new comment -->
    <form method="POST" action="/tweets/comments/<%= tweet.id %>">
      <div class="input-group">
        <input type="text" class="form-control" name="text" placeholder="Add a comment...">
        <button type="submit" class="btn btn-primary">Add Comment</button>
      </div>
    </form>

              <% if (tweet.isLikedByCurrentUser) { %>
                <form method="POST" action="/tweets/unlike/<%= tweet.id %>">
                  <button class="btn btn-secondary btn-sm float-end" type="submit">Unlike</button>
                </form>
              <% } else { %>
                <form method="POST" action="/tweets/like/<%= tweet.id %>">
                  <button class="btn btn-secondary btn-sm float-end" type="submit">Like</button>
                </form>
              <% } %>
              <% if(user.username === username) { %>
              <form method="POST" action="/tweets/<%= tweet.id %>?_method=DELETE">
                <input type="hidden" name="_method" value="DELETE">
                <button type="submit" class="btn btn-danger btn-sm float-end">Delete Tweet</button>
              </form>
             <% } %>
            </li>
          <% }); %>
        </ul>
        <% if(user.username === username) { %>

        <form action="/tweets/newtweet" method="POST">
          <div class="input-group mt-3">
            <input name="text" class="form-control" placeholder="New Tweet">
            <button type="submit" class="btn btn-primary">Tweet</button>
          </div>
        </form>
        <% } %>

      </div>
      <% if (user.username === username) { %>
      <div class="col-md-6">
        <h2>Other users to follow</h2>
        <ul class="list-group">
         <% users.forEach((user) => { %>
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <a href="/users/<%= user.id %>"><%= user.username %></a>
    <% if (followingUserIds.includes(user.id.toString())) { %>
      <form method="POST" action="/users/unfollow/<%= user.id %>">
        <button type="submit" class="btn btn-danger btn-sm">Unfollow</button>
      </form>
    <% } else { %>
      <form method="POST" action="/users/follow/<%= user.id %>">
        <button type="submit" class="btn btn-primary btn-sm">Follow</button>
      </form>
    <% } %>
  </li>
<% }); %>
          
        </ul>
      </div>
      <% } %>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
</body>
</html>
